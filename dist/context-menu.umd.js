(function(e,p){typeof exports=="object"&&typeof module<"u"?module.exports=p(require("vue")):typeof define=="function"&&define.amd?define(["vue"],p):(e=typeof globalThis<"u"?globalThis:e||self,e["context-menu"]=p(e.Vue))})(this,function(e){"use strict";let p=null;const $=t=>{p==null||p.closeMenu(),p=t},j=t=>{p=null},T={class:"icon"},_={key:0,class:"label"},L={name:"i-context-menu-item"},A=e.defineComponent({...L,props:{disabled:{type:Boolean,default:!1},customComponent:null,customClass:{default:""},label:{default:""},icon:{default:""},iconFontClass:{default:"iconfont"},showRightArrow:{type:Boolean,default:!1},clickClose:{type:Boolean,default:!0},clickableWhenHasChildren:{type:Boolean,default:!1},clickHandler:{type:Function,default:()=>{}}},setup(t){const n=t,i=e.useSlots(),c=e.ref(!1),a=e.inject("menuContext"),r=e.inject("globalNamespace"),d=e.inject("globalCloseMenu"),x=e.inject("globalOptions"),g=()=>{n.disabled||(i.submenu?n.clickableWhenHasChildren&&typeof n.clickHandler=="function"&&n.clickHandler():(typeof n.clickHandler=="function"&&n.clickHandler(),n.clickClose&&d()))},h=()=>{a.checkCloseOtherSubMenuTimeOut()||a.closeOtherSubMenu(),a.addOpenedSubMenu(()=>{c.value=!1}),c.value=!0},b={disabled:n.disabled,label:n.label,icon:n.icon,iconFontClass:n.iconFontClass,showRightArrow:n.showRightArrow,clickClose:n.clickClose,clickableWhenHasChildren:n.clickableWhenHasChildren};return(w,C)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass([e.unref(r)+"context-menu-item",t.disabled?"disabled":"",t.customClass]),onClick:g,onMouseenter:h},[t.customComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.customComponent),{key:1,data:b})):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("div",T,[typeof t.icon=="string"?(e.openBlock(),e.createElementBlock("i",{key:0,class:e.normalizeClass([t.icon,t.iconFontClass])},null,2)):(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.icon),{key:1,data:b}))]),typeof t.label=="string"?(e.openBlock(),e.createElementBlock("span",_,e.toDisplayString(t.label),1)):(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.label),{key:1,data:b})),t.showRightArrow?(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[typeof(e.unref(x).moreArrow||"")=="string"?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["right-arrow","more",e.unref(x).moreArrow])},null,2)):(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(x).moreArrow),{key:1,data:{...b,className:["right-arrow","more"]}},null,8,["data"]))],64)):e.createCommentVNode("",!0)],64)),c.value?e.renderSlot(w.$slots,"submenu",{key:2}):e.createCommentVNode("",!0)],34))}});var F=/^\d+((px)|%)?$/;function N(t){let n=t.offsetTop;return t.offsetParent!=null&&(n-=t.offsetParent.scrollTop,n+=N(t.offsetParent)),n}function O(t){let n=t.offsetLeft;return t.offsetParent!=null&&(n-=t.offsetParent.scrollLeft,n+=O(t.offsetParent)),n}const S=t=>F.test(String(t)),D={key:0,class:"divided"},I=[e.createElementVNode("div",{class:"double-arrow"},null,-1)],R=[e.createElementVNode("div",{class:"double-arrow"},null,-1)],U={name:"i-context-menu-sub"},q=e.defineComponent({...U,props:{items:null,maxWidth:null,minWidth:null,adjustPosition:{type:Boolean,default:!0}},setup(t){const n=t,i=3,c=document.body.clientHeight,a=document.body.clientWidth;let r=0;const d=e.inject("globalOptions"),x=e.inject("menuContext"),g=e.inject("globalNamespace"),{zIndex:h,getMyPosition:b,getParentWidth:w}=x,C=e.ref(!1),y=e.ref(0),m=e.ref(0),H=[],k=e.ref({x:0,y:0}),f=e.ref(),B=e.ref(),V=e.ref(),Q={zIndex:h+1,getMyPosition:()=>{const l={x:0,y:0};return f.value&&(l.x=f.value.offsetWidth+(d.xOffset||0)),d.yOffset&&(l.y=d.yOffset),l},getParentWidth:()=>{var l;return(l=f.value)==null?void 0:l.offsetWidth},addOpenedSubMenu(l){H.push(l)},closeOtherSubMenu(){H.forEach(l=>l()),H.splice(0,H.length)},checkCloseOtherSubMenuTimeOut(){return r?(clearTimeout(r),r=0,!0):!1},closeOtherSubMenuWithTimeOut(){r=setTimeout(()=>{r=0,this.closeOtherSubMenu()},200)}},z=l=>{var u,W,s,M;let o=0;l=="down"?o=Math.max(y.value-50,-m.value):o=Math.min(y.value+50,0),o>0&&(o=0),o<Number((u=B.value)==null?void 0:u.offsetHeight)-Number((W=f.value)==null?void 0:W.offsetHeight)&&(o=Number((s=B.value)==null?void 0:s.offsetHeight)-Number((M=f.value)==null?void 0:M.offsetHeight)),y.value=o},Z=e.computed(()=>{const l=c*.95,o=c*.8,u=(d==null?void 0:d.maxHeight)||0;return{maxWidth:n.maxWidth?S(n.maxWidth)?n.maxWidth:n.maxWidth+"px":"",minWidth:n.minWidth?S(n.minWidth)?n.minWidth:n.minWidth+"px":"",maxHeight:(o>u?o:l>u&&u!=0?u:l)+"px",zIndex:h,left:`${k.value.x}px`,top:`${k.value.y}px`}});return e.provide("menuContext",Q),e.onMounted(()=>{k.value=b(),e.nextTick(()=>{const l=f.value,o=B.value;if(!l||!o)return!1;if(n.adjustPosition&&f.value&&V.value){m.value=l.offsetHeight-(o==null?void 0:o.offsetHeight),C.value=l.offsetHeight>(o==null?void 0:o.offsetHeight);const u=O(l),W=N(o);u+l.offsetWidth-a>0?k.value.x-=(w?w():0)+l.offsetWidth-i:k.value.x-=i;const M=W+o.offsetHeight-c;M>0&&(k.value.y-=M*1.05)}})}),(l,o)=>{var W;const u=e.resolveComponent("i-context-menu-sub");return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass([e.unref(g)+"context-menu-sub",((W=e.unref(d))==null?void 0:W.customClass)||""]),style:e.normalizeStyle(e.unref(Z)),onContextmenu:o[2]||(o[2]=e.withModifiers(()=>{},["stop","prevent"])),ref_key:"sub",ref:B},[e.createElementVNode("div",{class:e.normalizeClass([e.unref(g)+"context-menu-sub-body"]),ref_key:"menu",ref:f,style:e.normalizeStyle({top:`${y.value}px`})},[t.items?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(t.items,(s,M)=>(e.openBlock(),e.createElementBlock("div",{key:M},[e.createVNode(A,{clickHandler:s.onClick,disabled:s.disabled,iconFontClass:e.unref(d).iconFontClass,icon:s.icon,label:s.label,customComponent:s.customComponent,customClass:s.customClass,clickClose:s.clickClose,clickableWhenHasChildren:s.clickableWhenHasChildren,showRightArrow:s.children&&s.children.length>0},e.createSlots({_:2},[s.children&&s.children.length>0?{name:"submenu",fn:e.withCtx(()=>[e.createVNode(u,{items:s.children,maxWidth:s.maxWidth,minWidth:s.minWidth,adjustPosition:s.adjustSubMenuPosition},null,8,["items","maxWidth","minWidth","adjustPosition"])]),key:"0"}:void 0]),1032,["clickHandler","disabled","iconFontClass","icon","label","customComponent","customClass","clickClose","clickableWhenHasChildren","showRightArrow"]),s.divided?(e.openBlock(),e.createElementBlock("div",D)):e.createCommentVNode("",!0)]))),128)):e.createCommentVNode("",!0)],6),e.createElementVNode("div",{class:e.normalizeClass([e.unref(g)+"context-menu-scroll"]),ref_key:"scroll",ref:V},[e.withDirectives(e.createElementVNode("div",{class:"updown up",onClick:o[0]||(o[0]=s=>z("up"))},I,512),[[e.vShow,C.value&&y.value<0]]),e.withDirectives(e.createElementVNode("div",{class:"updown down",onClick:o[1]||(o[1]=s=>z("down"))},R,512),[[e.vShow,C.value&&y.value>-m.value]])],2)],38)}}}),X={name:"i-context-menu"},Y=e.defineComponent({...X,props:{options:null,namespace:null},emits:["close"],setup(t,{expose:n,emit:i}){const c=t,a=e.ref(!0),r=e.ref("context-menu-host"),d={zIndex:(c.options||{}).zIndex||100,getMyPosition:()=>({x:c.options.x,y:c.options.y}),addOpenedSubMenu:()=>{},closeOtherSubMenu:()=>{}},x=()=>{document.removeEventListener("click",C,!0),document.removeEventListener("contextmenu",C,!0),document.removeEventListener("wheel",w,!0)},g=()=>{document.addEventListener("click",C,!0),document.addEventListener("contextmenu",C,!0),document.addEventListener("wheel",w,!0)},h=()=>{a.value=!1,i("close"),j()},b=m=>{for(;m;){if(m.classList&&m.classList.contains(r.value))return!1;m=m.parentNode}x(),h()},w=()=>{c.options.closeWhenScroll!==!1&&h()};function C(m){b(m.target)}const y=()=>{$({closeMenu:h})};return e.provide("globalOptions",c.options),e.provide("globalNamespace",c.namespace||""),e.provide("globalCloseMenu",h),e.provide("menuContext",d),y(),e.onMounted(()=>{g()}),e.onUnmounted(()=>{x()}),n({closeMenu:h}),(m,H)=>{var k,f,B;return a.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass([t.namespace+"context-menu",r.value,t.options.customClass])},[e.createVNode(q,{items:(k=t.options)==null?void 0:k.items,"max-width":(f=t.options)==null?void 0:f.maxWidth,"min-width":(B=t.options)==null?void 0:B.minWidth},null,8,["items","max-width","min-width"])],2)):e.createCommentVNode("",!0)}}}),te="",G={prefix:"",alias:"",namespace:""};let E={};const J=({options:t,namespace:n},i,c)=>{const a=e.h(Y,{options:t,namespace:n,onClose:()=>{e.render(null,i)}},c);return e.render(a,i),document.body.appendChild(i.firstElementChild),a.component},K=t=>t.replace(/[_-]+[a-zA-z]/g,n=>n.substr(-1).toUpperCase()),P=(t,n)=>{const{namespace:i}=E,c=document.createElement("div");return J({options:t,namespace:i?i+"-":""},c,n)};return{install:(t,n)=>{E={...G,...n};const{prefix:i,alias:c}=E,a=c||K([i||"","context","menu"].filter(r=>r&&r.trim()).join("-"));t.provide(a,P),t.config.globalProperties["$"+a]=P}}});
